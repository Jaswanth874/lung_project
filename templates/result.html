{% extends "layout.html" %}

{% block title %}Analysis Result - Lung Nodule Detection{% endblock %}

{% block content %}
<h2>ğŸ“Š Analysis Results</h2>

<div class="stat-card" style="margin-bottom: 2rem;">
    <h4>Confidence Score</h4>
    <div class="value">{{ "%.1f"|format(score * 100) }}%</div>
    <p style="margin-top: 0.5rem; opacity: 0.9; font-size: 0.875rem;">
        Raw Score: {{ "%.4f"|format(score) }}
    </p>
</div>

{% if boxes %}
<div class="card">
    <div class="card-header">
        <h3 style="margin-top: 0;">ğŸ” Detected Nodules</h3>
        <span class="badge badge-primary">{{ boxes|length }} detection{{ 's' if boxes|length != 1 else '' }}</span>
    </div>
    
    <div class="grid">
        {% for box in boxes %}
        <div style="background: var(--background); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
            <strong style="color: var(--primary);">Nodule {{ loop.index }}</strong>
            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-light);">
                <div>Position: ({{ "%.1f"|format(box[0]) }}, {{ "%.1f"|format(box[1]) }})</div>
                <div>Size: {{ "%.1f"|format(box[2] - box[0]) }} Ã— {{ "%.1f"|format(box[3] - box[1]) }}</div>
                <div style="margin-top: 0.5rem;">
                    <span class="badge badge-success">{{ "%.1f"|format(box[4] * 100) }}% confidence</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="info-box">
    <p style="margin: 0; font-weight: 500;">âœ… No nodules detected in this scan.</p>
</div>
{% endif %}

{% if image_fname %}
<div class="card">
    <h3 style="margin-top: 0;">ğŸ“¸ Annotated Image</h3>
    <img src="{{ url_for('serve_prediction', fname=image_fname) }}" alt="Analysis Result" style="width: 100%; max-width: 800px; margin: 1rem 0;">
</div>
{% endif %}

<div class="card" style="background: var(--background);">
    <h3 style="margin-top: 0;">ğŸ“„ Generate Report</h3>
    <p style="color: var(--text-light); margin-bottom: 1.5rem;">
        Create a comprehensive clinical report with detection findings and recommendations.
    </p>
    
    <form method="POST" action="{{ url_for('generate_report_route') }}" style="margin: 0;">
        <input type="hidden" name="score" value="{{ score }}">
        <input type="hidden" name="image_fname" value="{{ image_fname }}">
        <input type="hidden" name="boxes" value="{{ boxes }}">
        <button type="submit" class="btn">
            <span>ğŸ“‹ Generate Clinical Report</span>
        </button>
    </form>
</div>

<div class="btn-group" style="margin-top: 2rem;">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">
        <span>ğŸ”„ Analyze Another Scan</span>
    </a>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline">
        <span>ğŸ“Š View Dashboard</span>
    </a>
</div>
{% endblock %}
