{% extends "layout.html" %}

{% block title %}Clinical Report - Lung Nodule Detection{% endblock %}

{% block content %}
<h2>ğŸ“‹ Clinical Report</h2>

<div class="card">
    <div class="card-header">
        <h3 style="margin-top: 0;">ğŸ‘¤ Patient Information</h3>
    </div>
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
        <div>
            <strong style="color: var(--text-light); font-size: 0.875rem;">Patient Name</strong>
            <div style="font-size: 1.125rem; font-weight: 600; margin-top: 0.25rem;">{{ user_name }}</div>
        </div>
        <div>
            <strong style="color: var(--text-light); font-size: 0.875rem;">Scan ID</strong>
            <div style="font-size: 1.125rem; font-weight: 600; margin-top: 0.25rem;">#{{ scan_id }}</div>
        </div>
        <div>
            <strong style="color: var(--text-light); font-size: 0.875rem;">Report Date</strong>
            <div style="font-size: 1.125rem; font-weight: 600; margin-top: 0.25rem;">{{ report_date }}</div>
        </div>
    </div>
</div>

<div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);">
    <div class="card-header">
        <h3 style="margin-top: 0; color: var(--primary);">ğŸ” Detection Results</h3>
    </div>
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
        <div class="stat-card" style="background: var(--primary);">
            <h4>Confidence</h4>
            <div class="value">{{ "%.1f"|format(confidence_score * 100) }}%</div>
        </div>
        <div class="stat-card" style="background: var(--accent);">
            <h4>Detections</h4>
            <div class="value">{{ num_detections }}</div>
        </div>
        <div class="stat-card" style="background: var(--success);">
            <h4>Avg Diameter</h4>
            <div class="value">{{ avg_diameter }}mm</div>
        </div>
    </div>
</div>

{% if image_fname %}
<div class="card">
    <h3 style="margin-top: 0;">ğŸ“¸ Annotated Image</h3>
    <img src="{{ url_for('serve_prediction', fname=image_fname) }}" alt="Analysis Result" style="width: 100%; max-width: 800px; margin: 1rem 0;">
</div>
{% endif %}

<div class="info-box warning">
    <h3 style="margin-top: 0; color: #92400e;">âš ï¸ Important Notice</h3>
    <p style="margin: 0; color: #78350f;">
        This report is generated by an AI system and is intended for clinical decision support only. 
        It should not replace professional medical judgment or clinical evaluation. 
        Always consult with qualified healthcare professionals for medical decisions.
    </p>
</div>

<div class="card" style="background: var(--background); margin-top: 2rem;">
    <h3 style="margin-top: 0;">ğŸ“¥ Download Report</h3>
    <p style="color: var(--text-light); margin-bottom: 1.5rem;">
        Download this report in your preferred format for documentation and sharing.
    </p>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('download_report') }}" class="btn">
            ğŸ“„ Download TXT
        </a>
        <a href="{{ url_for('download_report_pdf') }}" class="btn btn-secondary">
            ğŸ“‘ Download PDF
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-outline">
            ğŸ  Back to Home
        </a>
    </div>
</div>
{% endblock %}
